/*! crunchtask - v0.8.13 - 2015-04-27 */
!function(){function a(a,b){return function(){a.apply(b,arguments)}}function b(b){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof b)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],h(b,a(d,this),a(e,this))}function c(a){var b=this;return null===this._state?void this._deferreds.push(a):void j(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(e){return void a.reject(e)}a.resolve(d)})}function d(b){try{if(b===this)throw new TypeError("A promise cannot be resolved with itself.");if(b&&("object"==typeof b||"function"==typeof b)){var c=b.then;if("function"==typeof c)return void h(a(c,b),a(d,this),a(e,this))}this._state=!0,this._value=b,f.call(this)}catch(g){e.call(this,g)}}function e(a){this._state=!1,this._value=a,f.call(this)}function f(){for(var a=0,b=this._deferreds.length;b>a;a++)c.call(this,this._deferreds[a]);this._deferreds=null}function g(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function h(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var i;i="object"==typeof window&&window?window:global,"undefined"!=typeof module&&module.exports?module.exports=i.Promise?i.Promise:b:i.Promise||(i.Promise=b);var j=i.setImmediate||function(a){setTimeout(a,1)},k=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.prototype["catch"]=function(a){return this.then(null,a)},b.prototype.then=function(a,d){var e=this;return new b(function(b,f){c.call(e,new g(a,d,b,f))})},b.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&k(arguments[0])?arguments[0]:arguments);return new b(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},b.resolve=function(a){return a&&"object"==typeof a&&a.constructor===b?a:new b(function(b){b(a)})},b.reject=function(a){return new b(function(b,c){c(a)})},b.race=function(a){return new b(function(b,c){for(var d=0,e=a.length;e>d;d++)a[d].then(b,c)})}}(),/**
 * @preserve
 * Created by ANDREW on 10/10/2014.
 * @requires 'bower_components/promise-polyfill'
 */
function(){"use strict";function a(a){return J.isFunction(a)||a instanceof x}function b(a,b){throw J.isUndefined(b)&&(b=a,a="Generic"),new Error(["`CT_",a,"`. Message: ",b].join(""))}function c(){return++Q}function d(a,b){for(var c in a)I.call(a,c)&&(a[c]=b+c);return a}function e(a,b){for(var c={},d=J.isArray(b),e=0,f=a.length;f>e;e++)c[a[e]]=d?b[e]:b;return c}function f(a,b){for(var c in b)I.call(b,c)&&(a[c]=b[c]);return a}function g(){var a=this,b=arguments[0],c=H.call(arguments,1);return!J.isFunction(b)&&J.isFunction(c[0])&&(a=arguments[0],b=c.shift()),function(){var d=H.call(arguments,0);return b.apply(a,[].concat(c,d))}}function h(a,b){var c=H.call(arguments,2);return function(){var d=H.call(arguments,0);return b.apply(a,[].concat(c,d))||a}}function i(){var a=H.call(arguments,0);return function(){for(var b,c=H.call(arguments,0),d=[].concat(a);(b=d.shift())&&J.isFunction(b);)b.apply(this,c)}}function j(a,b,c){if(c)for(var d,e,f=H.call(arguments,3),g=b.split(/\s*,\s*/);d=g.shift();)(e=a[d])?e.push([c,f]):a[d]=[[c,f]]}function k(a,b){var c=H.call(arguments,2);if(a[b])for(var d,e,f=a[b],g=0,h=f.length;h>g;g++)if(d=f[g][0],e=f[g][1],d)try{d.apply(this,[].concat(e,c))}catch(i){L.debug&&console.log(i+", stack: "+i.stack)}}function l(a,b,c){var d=this;return setTimeout(function(){b.apply(d,c||[])},a||0)}function m(a,b){return J.isFunction(a)&&(b=a,a=this),J.isFunction(b)||(b=function(){}),function(){var c=H.call(arguments,0);try{return b.apply(a,c),!0}catch(d){return P=d,L.debug&&console.log(d+", stack: "+d.stack),!1}}}function n(a,b){var d=this,e=N;N=null;var f={},h={task:d,id:"T_"+d.id+":"+c(),conditionsToMeet:1,state:S.init,runBlock:0,runArgs:H.call(arguments,2),descriptionFn:a,parentTask:e},i=null,j=function(a,c){i=g(h,p,f,b,{resolve:a,reject:c}),l.call(h,0,q,[f])};return o(new K(j),f,i)}function o(a,b,c){return c(a),f(a,{onError:g(a,b.runEventsOn,R.error),abort:g(a,b.abort),pause:g(a,b.pause),resume:g(a,b.resume),done:g(a,b.runEventsOn,R.done),fail:g(a,b.runEventsOn,R.fail),always:g(a,b.runEventsOn,[R.done,R.fail,R.error].join()),progress:g(a,b.runEventsOn,R.progress)})}function p(a,b,c,d){function e(){if(!T[n.state]){var a=H.call(arguments,0);n.state=S.error,n.value=a,h(a,R.error,r)}}function h(a,b,c){t.apply(this,[b].concat(a)),c&&l.call(o,0,c,[a])}function j(a,b){l(1,function(){a.runCount+b.runCount>0||(O=!0,a._signalIdle(),O=!0,b._signalIdle(),delete n.parentTask,delete b.childTask)})}function k(a){a.runCount=Math.max(0,a.runCount-1),a.runCount||(delete a.isAborted,delete a.isPaused,a.childTask?j(a.childTask,a):n.parentTask?j(a,n.parentTask):l(1,function(){a.runCount||(O=!0,a._signalIdle())}))}var n=this,o=n.task,p=n.parentTask,q=m(c.resolve),r=m(c.reject),s=w(d),t=i(s.trigger,b.trigger);return p&&(p.childTask=o),f(a,{setupInit:function(a){return L.trace&&console.log("setupInit",new Date-0),T[n.state]?void 0:J.isUndefined(a)||J.isFunction(a)?void(n.initFn=m(o,a)):e("CrunchTask.description.initSetup","Init setup expects an optional function.")},setupBody:function(a,b,c){if(L.trace&&console.log("setupBody",new Date-0),!T[n.state]){if(!J.isFunction(a))return e("CrunchTask.description.bodySetup","Body setup expects a function as a first optional arg.");if(!J.isUndefined(b)&&!J.isBoolean(b)&&!J.isNumber(b))return e("CrunchTask.description.bodySetup","Body setup expects a number or false as a 2nd optional arg.");if(!J.isUndefined(c)&&!J.isNumber(c))return e("CrunchTask.description.bodySetup","Body setup expects a number as a 3rd optional arg.");n.bodyFn=m(o,a),n.conditionsToMeet--,n.needRepeat=b,n.timeoutAmount=c}},setupFin:function(a){return L.trace&&console.log("setupFin",new Date-0),T[n.state]?void 0:J.isUndefined(a)||J.isFunction(a)?void(n.finallyFn=m(o,a)):e("CrunchTask.description.finSetup","Fin setup expects a function as a first optional arg.")},signalError:e,runEventsOn:s.on,goRunning:function(){o.runCount++,n.state=S.running,b.trigger(R.run,n.id)},resolve:function(){if(!T[n.state]){var a=H.call(arguments,0);n.state=S.resolved,n.value=a,k(o),h(a,R.done,q)}},reject:function(){if(!T[n.state]){var a=H.call(arguments,0);n.state=S.rejected,n.value=a,k(o),h(a,R.fail,r)}},abort:function(){return T[n.state]?void 0:(n.state=S.aborted,this)},pause:function(){return T[n.state]?void 0:(n.state=S.paused,this)},resume:function(){return T[n.state]?void 0:(n.state=S.running,this)},sendNotify:g(t,R.progress)})}function q(a){var b=this,c=b.task,d=b.descriptionFn;if(!d)return a.signalError("CrunchTask.description.empty","Description function is empty.");if(L.trace&&console.log("before descriptionFn run",new Date-0),!m(c,d)(a.setupInit,a.setupBody,a.setupFin)||T[b.state]||0!==b.conditionsToMeet)return a.signalError("CrunchTask.description.else","");L.trace&&console.log("after descriptionFn run",new Date-0);var e=b.needRepeat;e=e===!1?e:0===e?e:e||L.timeLimit,b.needRepeat=0===e?!0:e,b.timeoutAmount=b.timeoutAmount||L.timeoutAmount,L.trace&&(console.log("collected `needRepeat`:",b.needRepeat),console.log("collected `timeoutAmount`:",b.timeoutAmount)),a.goRunning(),L.trace&&console.log("before defer",new Date-0),l.call(b,0,function(){L.trace&&console.log("inside defer",new Date-0),this.initFn&&!this.initFn.apply(this,this.runArgs)&&a.signalError("CrunchTask.description.init"),L.trace&&console.log("before  proceedBodyFn",new Date-0),r.call(this,a,!0)})}function r(a,b){L.trace&&(console.log("inside proceedBodyFn",this.id,new Date-0),console.log("isFirstTime",b),console.log("this.timeoutAmount",this.timeoutAmount)),l.call(this,b?0:this.timeoutAmount,function(a){L.trace&&console.log("inside proceedBodyFn:defer",this.id,new Date-0);var b,c,d,e,f=this.task,g=this.needRepeat,h=J.isNumber(g)?g:0,i=0,j=0,k=this.state===S.running&&!f.isPaused&&!f.isAborted;if(k){b=new Date;do{try{c=new Date,this.bodyFn(a.resolve,a.reject,a.sendNotify,{batchStarted:b,batchIndex:i,batchElapsed:j,runBlock:this.runBlock})}catch(l){L.debug&&console.log(l+", stack: "+l.stack),a.signalError("body",l)}j+=new Date-c,i++,d=g&&0!==h&&h>j&&this.state===S.running}while(d)}else(f.isAborted||this.state===S.aborted)&&a.reject("aborted");return(e=g&&U[this.state]&&!f.isAborted)?(this.runBlock++,L.trace&&console.log("rescheduling proceedBodyFn",this.id,new Date-0),r.call(this,a)):(g===!1&&a.resolve(),void(this.finallyFn&&!this.finallyFn.call(this,V[this.state])&&a.signalError("CrunchTask.description.fin",this.status)))},[a])}function s(){return this.isAborted=!0,this}function t(){return this.isPaused=!0,this}function u(){return delete this.isPaused,this}function v(a){function b(){for(var a,b=H.call(arguments,0);a=d.shift();)F(a)(b)}var c,d=H.call(arguments,1);try{return c=new x(a)}finally{c.done(b),this.done(b)}}function w(a,b){var c=b||{};return{on:h(a,j,c),trigger:h(a,k,c)}}function x(a){return this instanceof x?y(this,w(this),a):new x(a)}function y(a,b,d){return f(a,{id:c(),timestamp:new Date-0,runCount:0,isIdle:function(){return 0===a.runCount},pause:h(a,t),resume:h(a,u),abort:h(a,s),run:g(a,n,d,b),then:g(a,v),onRun:g(b.on,R.run),onIdle:g(b.on,R.idle),onError:g(b.on,R.error),done:g(b.on,R.done),fail:g(b.on,R.fail),always:g(b.on,[R.done,R.fail,R.error].join()),progress:g(b.on,R.progress),_signalIdle:function(){O&&(O=!1,b.trigger(R.idle))}})}function z(){for(var b=arguments.length,c=0;a(arguments[b-1-c]);)c++;var d=H.call(arguments,0,b-c),e=H.call(arguments,-c),f=new W(d),g=e[0],h=e[1]||function(){};return g?D(f,g,h):E()}function A(a,b,c){return new x(function(d,e,f){var g,h,i,j=a,k=F(b,this),l=F(c,this);d(function(b){b&&(j=a),g=new W([0,j.length]),i=g.canAdvance(!0)}),e(function(a){i&&(h=g.valueOf()[0],k([j[h],h])),i&&g.canAdvance()||a()},L.timeLimit,L.timeoutAmount),f(function(){l(g.valueOf())})})}function B(a,b,c,d){return new x(function(e,f,g){var h,i,j,k=a,l=b,m=F(c,this),n=F(d,this);e(function(b,c){b&&(k=a),h=new W([0,k.length]),j=h.canAdvance(!0),J.isUndefined(c)||(l=c)}),f(function(a){j&&(i=h.valueOf()[0],l=m([l,k[i],i])),j&&h.canAdvance()||a(l)},L.timeLimit,L.timeoutAmount),g(function(){n(l,h.valueOf())})})}function C(){var a=H.call(arguments,0);return new W(a)}function D(a,b,c){return new x(function(d,e,f){var g,h=a,i=F(b,this),j=F(c,this);d(function(){var a=H.call(arguments,0);a.length&&(h=new W(a)),g=h.canAdvance(!0)}),e(function(a){g&&i(h.valueOf()),g&&h.canAdvance()||a()},L.timeLimit,L.timeoutAmount),f(function(){j(h.valueOf())})})}function E(){return new x(function(a,b){b(function(a){a()})})}function F(a,b){return J.isFunction(a)?function(c){return a.apply(b||this,c)}:a instanceof x?function(c){return N=b,a.run.apply(a,c)}:function(a){return a}}var G="object"==typeof window&&window?window:global,H=[].slice,I={}.hasOwnProperty,J=function(){function a(a){return function(b){return f.call(b)===a}}for(var b,c,d,e={},f=Object.prototype.toString,g=[!0,1,[],function(){},b,{}],h=/\s+(\w+)]/,i=0,j=g.length;j>i;i++)c=(d=f.call(g[i])).replace("DOMWindow","Undefined"),e["is"+c.match(h)[1]]=a(d);return e}(),K="undefined"!=typeof K?K:"undefined"!=typeof G.Promise?G.Promise:"undefined"!=typeof require?require("promise-polyfill"):!1;K===!1&&b("Linking",'Dependency isn\'t met: "promise-polyfill"'),"undefined"!=typeof module&&module.exports?module.exports=G.CrunchTask?G.CrunchTask:x:G.CrunchTask||(G.CrunchTask=x);var L={trace:!1,timeLimit:100,timeoutAmount:0,debug:!1},M={trace:!1,timeLimit:100,timeoutAmount:0,debug:!1},N=null,O=!1,P=null;x["for"]=z,x.range=z,x.rangeCheck=C,x.rangeNextAndCheck=function(a,b){return a.canAdvance(b)},x.forEach=A,x.reduce=B,x.config=function(a){if(!J.isObject(a))return x.config(M);var b={};for(var c in a)I.call(a,c)&&I.call(L,c)&&(L[c]=a[c],b[c]=a[c]);return b},x.config(!1);var Q=0,R=d({run:null,done:null,fail:null,abort:null,error:null,progress:null,idle:null},"event."),S=d({init:null,error:null,running:null,paused:null,resolved:null,rejected:null,aborted:null},"state."),T=e([S.error,S.resolved,S.rejected,S.aborted],!0),U=e([S.running,S.paused],!0),V=e([S.resolved,S.rejected,S.error,S.aborted],["success","failure","error","aborted"]),W=function(){function a(d){return(arguments.length>1||!J.isArray(d))&&b("Ranges","Pass strictly a single arguments of type array"),this instanceof a?void(this.data=c(e(d))):new a(d)}function c(a){for(var b=[],c=0,e=a.length;e>c;c++)b.push(d(a[c]));return b}function d(a){var c,d=a.length,e=d-1,f=J.isBoolean(a[e]);switch(d-(f?1:0)){case 2:case 3:return c=d-(f?1:0)===3?a[2]:a[0]<=a[1]?1:-1,{from:a[0],current:a[0],to:a[1],step:c,inclusive:f?a[d-1]:!1};case 0:case 1:b("Ranges","Use at least two values to define a range.");break;default:d%2===0&&d%3===0?b("Ranges","Use arrays to split range parts. Cannot determine pattern now."):b("Ranges","Use arrays to split range parts properly.")}}function e(a,b){for(var c,d,f=[],g=[];a.length;)c=a.splice(0,1)[0],d=J.isArray(c),d&&b!==!0?(g.length&&(f.push(g),g=[]),f.push(e(c,!0))):J.isBoolean(c)?(g.push(c),f.push(g),g=[]):J.isNumber(c)&&g.push(c);return g.length&&f.push(g),b===!0?f[0]:f}return a.prototype.toString=a.prototype.valueOf=function(){for(var a=[],b=0,c=this.data.length;c>b;b++)a.push(this.data[b].current);return a},a.prototype.canAdvance=function(a){var b,c,d,e=0,f=this.data,g=f.length;do c=!1,b=f[e],a!==!0&&(b.current+=b.step),(!b.inclusive&&b.current===b.to||(b.step>0?b.current>b.to:b.current<b.to))&&(b.current=b.from,c=!0,e++),d=g>e;while(c&&d);return!c&&d},a}()}();
//# sourceMappingURL=crunchtask.min.js.map